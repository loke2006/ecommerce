{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Complete Your Payment - eKart</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
          darkMode: "class",
          theme: {
            extend: {
              colors: {
                "primary": "#3caff6",
                "background-light": "#f5f7f8",
                "background-dark": "#101b22",
              },
              fontFamily: {
                "display": ["Inter", "sans-serif"]
              },
            },
          },
        }
    </script>
    <style>
        .material-symbols-outlined {
          font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        
        .navbar-links.nav-active {
            display: flex !important;
            flex-direction: column;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            z-index: 50;
        }
        
        .dark .navbar-links.nav-active {
            background: #1e293b;
        }
        
        @media (min-width: 768px) {
            .navbar-links {
                display: flex !important;
                flex-direction: row !important;
                position: static !important;
                background: transparent !important;
            }
        }

        .payment-method-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-method-card:hover {
            border-color: #3caff6;
            box-shadow: 0 4px 12px rgba(60, 175, 246, 0.15);
        }

        .payment-method-card input[type="radio"]:checked ~ .payment-method-label {
            color: #3caff6;
            font-weight: 600;
        }

        .payment-fields {
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading Screen Styles */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease;
        }

        .loading-overlay.active {
            display: flex !important;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: #3caff6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #3caff6;
            border-radius: 50%;
            margin: 0 4px;
            animation: pulse 1.4s infinite;
        }

        .pulse-dot:nth-child(1) { animation-delay: 0s; }
        .pulse-dot:nth-child(2) { animation-delay: 0.2s; }
        .pulse-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes pulse {
            0%, 60%, 100% { opacity: 0.3; transform: scale(0.8); }
            30% { opacity: 1; transform: scale(1); }
        }

        .step-indicator {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background: rgba(60, 175, 246, 0.2);
            border: 2px solid rgba(60, 175, 246, 0.4);
            color: white;
            font-size: 18px;
        }

        .step.active .step-circle {
            background: #3caff6;
            border-color: #3caff6;
            animation: scaleUp 0.5s ease;
        }

        @keyframes scaleUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .step-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            width: 60px;
        }

        .step.active .step-label {
            color: white;
            font-weight: 600;
        }

        .checkmark {
            display: none;
            animation: checkmark-draw 0.6s ease;
        }

        .step.completed .checkmark {
            display: block;
        }

        @keyframes checkmark-draw {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-[#0d161c] dark:text-white">
<div class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden">
<div class="layout-container flex h-full grow flex-col">

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-container">
        <!-- Main Spinner -->
        <div class="spinner"></div>
        
        <!-- Loading Text -->
        <h2 class="text-2xl font-bold text-white mb-2">Processing Payment</h2>
        <p class="text-slate-300 mb-8">Please wait while we securely process your payment...</p>

        <!-- Animated Dots -->
        <div style="display: flex; gap: 8px; margin-bottom: 30px;">
            <div class="pulse-dot"></div>
            <div class="pulse-dot"></div>
            <div class="pulse-dot"></div>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-circle">
                    <span id="step1-icon">1</span>
                    <span class="checkmark" style="color: #22c55e; position: absolute;">✓</span>
                </div>
                <div class="step-label">Verifying</div>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">
                    <span id="step2-icon">2</span>
                    <span class="checkmark" style="color: #22c55e; position: absolute;">✓</span>
                </div>
                <div class="step-label">Processing</div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">
                    <span id="step3-icon">3</span>
                    <span class="checkmark" style="color: #22c55e; position: absolute;">✓</span>
                </div>
                <div class="step-label">Confirming</div>
            </div>
        </div>

        <!-- Additional Info -->
        <div class="mt-8 text-center">
            <p class="text-xs text-slate-400">Do not close this page or refresh your browser</p>
        </div>
    </div>
</div>

<!-- Navbar -->
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-slate-200 dark:border-slate-800 px-4 md:px-10 py-3 bg-background-light dark:bg-background-dark/80 backdrop-blur-sm sticky top-0 z-50">
<nav class="navbar w-full">
<div class="navbar-container flex items-center justify-between w-full">
<a href="{% url 'list_products' %}" class="brand text-primary font-bold text-xl">eKart</a>
<button class="menu-toggle md:hidden" id="menu-toggle" aria-label="Toggle navigation">
<span class="block w-6 h-0.5 bg-current mb-1.5"></span>
<span class="block w-6 h-0.5 bg-current mb-1.5"></span>
<span class="block w-6 h-0.5 bg-current"></span>
</button>
<div class="navbar-links hidden md:flex items-center gap-6" id="navbar-links">
<a href="{% url 'view_cart' %}" class="cart-overview flex items-center gap-2 text-primary hover:opacity-80 transition-opacity" aria-label="View Cart">
<span class="material-symbols-outlined">shopping_cart</span>
<span class="cart-count bg-primary text-white rounded-full px-2 py-0.5 text-xs font-bold">{{ cart_item_count|default:0  }}</span>
</a>
<a href="{% url 'user_orders_view' %}" class="nav-item text-[#0d161c] dark:text-slate-300 hover:text-primary dark:hover:text-primary text-sm font-medium transition-colors">My Orders</a>
<a href="{% url 'user_payments_view' %}" class="nav-item text-[#0d161c] dark:text-slate-300 hover:text-primary dark:hover:text-primary text-sm font-medium transition-colors">Payment History</a>
<a href="{% url 'chat_page' %}" class="nav-item text-[#0d161c] dark:text-slate-300 hover:text-primary dark:hover:text-primary text-sm font-medium transition-colors">Chat Assistant</a>
<form method="POST" action="{% url 'custom_logout' %}" class="logout-form" style="display: inline;">
{% csrf_token %}
<button type="submit" class="nav-item text-[#0d161c] dark:text-slate-300 hover:text-red-500 dark:hover:text-red-400 text-sm font-medium transition-colors flex items-center gap-1">
<span class="material-symbols-outlined">logout</span>
<span>Logout</span>
</button>
</form>
</div>
</div>
</nav>
</header>

<main class="flex-1">
<div class="layout-content-container flex flex-col w-full px-4 md:px-10 py-8">

<!-- Breadcrumb -->
<nav class="mb-6">
    <ol class="flex items-center gap-2 text-sm">
        <li><a href="{% url 'list_products' %}" class="text-primary hover:underline">Home</a></li>
        <li class="text-slate-400">/</li>
        <li><a href="{% url 'view_cart' %}" class="text-primary hover:underline">Cart</a></li>
        <li class="text-slate-400">/</li>
        <li class="text-slate-600 dark:text-slate-400 font-medium">Payment</li>
    </ol>
</nav>

<!-- Page Title -->
<h1 class="text-4xl font-bold text-[#0d161c] dark:text-white mb-8">Complete Your Payment</h1>

<!-- Main Grid Layout -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    
    <!-- Payment Form - Left Side -->
    <div class="lg:col-span-2">
        <!-- Payment Method Selection -->
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-md border border-slate-200 dark:border-slate-700 p-6 mb-8">
            <h2 class="text-2xl font-bold text-[#0d161c] dark:text-white mb-6">
                <span class="material-symbols-outlined inline mr-2">payment</span>
                Select Payment Method
            </h2>
            
            <!-- Payment Form STARTS HERE -->
            <form method="POST" class="space-y-6" id="paymentForm">
                {% csrf_token %}
                
                <div class="space-y-4">
                    <!-- Credit Card Option -->
                    <label class="payment-method-card flex items-center p-4 border-2 border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-900/50 cursor-pointer transition-all">
                        <input type="radio" name="payment_method" value="credit" class="w-5 h-5 text-primary cursor-pointer" checked />
                        <span class="material-symbols-outlined text-3xl mx-4 text-slate-600 dark:text-slate-400">credit_card</span>
                        <div class="flex-grow">
                            <div class="payment-method-label text-lg font-semibold text-[#0d161c] dark:text-white">Credit/Debit Card</div>
                            <p class="text-sm text-slate-600 dark:text-slate-400">Visa, Mastercard, or Amex</p>
                        </div>
                    </label>

                    <!-- UPI Option -->
                    <label class="payment-method-card flex items-center p-4 border-2 border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-900/50 cursor-pointer transition-all">
                        <input type="radio" name="payment_method" value="upi" class="w-5 h-5 text-primary cursor-pointer" />
                        <span class="material-symbols-outlined text-3xl mx-4 text-slate-600 dark:text-slate-400">smartphone</span>
                        <div class="flex-grow">
                            <div class="payment-method-label text-lg font-semibold text-[#0d161c] dark:text-white">UPI Payment</div>
                            <p class="text-sm text-slate-600 dark:text-slate-400">Google Pay, Paytm, PhonePe</p>
                        </div>
                    </label>

                    <!-- Bank Transfer Option -->
                    <label class="payment-method-card flex items-center p-4 border-2 border-slate-200 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-900/50 cursor-pointer transition-all">
                        <input type="radio" name="payment_method" value="bank" class="w-5 h-5 text-primary cursor-pointer" />
                        <span class="material-symbols-outlined text-3xl mx-4 text-slate-600 dark:text-slate-400">account_balance</span>
                        <div class="flex-grow">
                            <div class="payment-method-label text-lg font-semibold text-[#0d161c] dark:text-white">Bank Transfer</div>
                            <p class="text-sm text-slate-600 dark:text-slate-400">Direct bank transfer</p>
                        </div>
                    </label>
                </div>

                <!-- Payment Details Section -->
                <div class="bg-slate-50 dark:bg-slate-900/50 rounded-xl p-6 mt-8">
                    <!-- Credit Card Fields -->
                    <div id="credit_fields" class="payment-fields">
                        <h3 class="text-lg font-bold text-[#0d161c] dark:text-white mb-4">
                            <span class="material-symbols-outlined inline mr-2">credit_card</span>
                            Credit Card Details
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-[#0d161c] dark:text-white mb-2">Card Number</label>
                                <input type="text" name="card_no" placeholder="1234 5678 9012 3456" maxlength="19" pattern="[0-9]{4} [0-9]{4} [0-9]{4} [0-9]{4}" class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-[#0d161c] dark:text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-[#0d161c] dark:text-white mb-2">Cardholder Name</label>
                                <input type="text" name="holder_name" placeholder="John Doe" maxlength="50" pattern="[a-zA-Z\s]+" class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-[#0d161c] dark:text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-[#0d161c] dark:text-white mb-2">Expiry Date</label>
                                <input type="text" name="expiry_date" placeholder="MM/YY" maxlength="5" class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-[#0d161c] dark:text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20" />
                            </div>
                        </div>
                    </div>

                    <!-- UPI Fields -->
                    <div id="upi_fields" class="payment-fields">
                        <h3 class="text-lg font-bold text-[#0d161c] dark:text-white mb-4">
                            <span class="material-symbols-outlined inline mr-2">smartphone</span>
                            UPI Details
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-[#0d161c] dark:text-white mb-2">Wallet ID / Mobile Number</label>
                                <input type="text" name="wallet_id" placeholder="9876543210 or name@upi" maxlength="50" pattern="[0-9]{10} or [a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-[#0d161c] dark:text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-[#0d161c] dark:text-white mb-2">Email Address</label>
                                <input type="email" name="email" placeholder="your@email.com" class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-[#0d161c] dark:text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-[#0d161c] dark:text-white mb-2">Wallet Provider</label>
                                <select name="wallet_provider" class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-[#0d161c] dark:text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20">
                                    <option value="">--Select Provider--</option>
                                    <option value="Google Pay">Google Pay</option>
                                    <option value="Paytm">Paytm</option>
                                    <option value="PhonePe">PhonePe</option>
                                    <option value="BHIM">BHIM</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Bank Transfer Fields -->
                    <div id="bank_fields" class="payment-fields">
                        <h3 class="text-lg font-bold text-[#0d161c] dark:text-white mb-4">
                            <span class="material-symbols-outlined inline mr-2">account_balance</span>
                            Bank Account Details
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-[#0d161c] dark:text-white mb-2">Bank Account Number</label>
                                <input type="text" name="bank_acc_no" placeholder="1234567890" minlength="10" maxlength="18" pattern="[0-9]{10,18}" class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-[#0d161c] dark:text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-[#0d161c] dark:text-white mb-2">Bank Name</label>
                                <input type="text" name="bank_name" placeholder="ICICI Bank, HDFC, etc." class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-[#0d161c] dark:text-white focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20" />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="mt-8">
                    <button type="submit" class="w-full py-3 bg-primary hover:bg-blue-600 text-white font-bold rounded-lg transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2" id="submitBtn">
                        <span class="material-symbols-outlined">check_circle</span>
                        Complete Payment
                    </button>
                </div>
            </form>
            <!-- Payment Form ENDS HERE -->

            <!-- Security Badge -->
            <div class="mt-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 flex items-center gap-3">
                <span class="material-symbols-outlined text-green-600 dark:text-green-400">verified_user</span>
                <div>
                    <p class="text-sm font-semibold text-green-700 dark:text-green-400">Secure Payment</p>
                    <p class="text-xs text-green-600 dark:text-green-400">Your payment is encrypted and secure</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Summary - Right Side -->
    <div class="lg:col-span-1">
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 p-6 sticky top-24">
            <h2 class="text-xl font-bold text-[#0d161c] dark:text-white mb-6">Order Summary</h2>
            
            <div class="space-y-4 mb-6">
                <div class="flex justify-between text-sm">
                    <span class="text-slate-600 dark:text-slate-400">Subtotal:</span>
                    <span class="font-medium text-[#0d161c] dark:text-white">${{ total_amount }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-600 dark:text-slate-400">Shipping:</span>
                    <span class="font-medium text-green-600">FREE</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-600 dark:text-slate-400">Tax (est.):</span>
                    <span class="font-medium text-[#0d161c] dark:text-white">$0.00</span>
                </div>
                <hr class="border-slate-200 dark:border-slate-700" />
                <div class="flex justify-between text-lg font-bold">
                    <span class="text-[#0d161c] dark:text-white">Total:</span>
                    <span class="text-primary">${{ total_amount }}</span>
                </div>
            </div>

            <!-- Order Info -->
            <div class="bg-slate-50 dark:bg-slate-900/50 rounded-lg p-4 text-sm space-y-2">
                <p class="text-slate-600 dark:text-slate-400"><span class="font-semibold">Status:</span> <span class="text-orange-600 font-semibold">Pending Payment</span></p>
            </div>

            <!-- Info Box -->
            <div class="mt-6 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 text-xs text-blue-700 dark:text-blue-400">
                <p><strong>Note:</strong> You will receive an order confirmation and invoice once payment is completed successfully.</p>
            </div>
        </div>
    </div>
</div>

</div>
</main>

<!-- Footer -->
<footer class="bg-slate-100 dark:bg-slate-900 mt-20 px-4 md:px-10 py-12 text-[#0d161c] dark:text-slate-100 border-t border-slate-200 dark:border-slate-800">
<div class="grid grid-cols-2 md:grid-cols-5 gap-10 container mx-auto">
<div>
<h4 class="font-bold text-[#0d161c] dark:text-slate-200 mb-4">Customer Service</h4>
<ul class="space-y-2 text-sm">
<li><a class="hover:text-primary transition-colors" href="#">Contact Us</a></li>
<li><a class="hover:text-primary transition-colors" href="#">Shipping & Returns</a></li>
<li><a class="hover:text-primary transition-colors" href="#">Order Tracking</a></li>
</ul>
</div>
<div>
<h4 class="font-bold text-[#0d161c] dark:text-slate-200 mb-4">About Us</h4>
<ul class="space-y-2 text-sm">
<li><a class="hover:text-primary transition-colors" href="#">Our Story</a></li>
<li><a class="hover:text-primary transition-colors" href="#">Careers</a></li>
<li><a class="hover:text-primary transition-colors" href="#">Press</a></li>
</ul>
</div>
<div>
<h4 class="font-bold text-[#0d161c] dark:text-slate-200 mb-4">Shop</h4>
<ul class="space-y-2 text-sm">
<li><a class="hover:text-primary transition-colors" href="#">New Arrivals</a></li>
<li><a class="hover:text-primary transition-colors" href="#">Best Sellers</a></li>
<li><a class="hover:text-primary transition-colors" href="#">Sale</a></li>
</ul>
</div>
<div>
<h4 class="font-bold text-[#0d161c] dark:text-slate-200 mb-4">Company</h4>
<ul class="space-y-2 text-sm">
<li><a class="hover:text-primary transition-colors" href="#">Blog</a></li>
<li><a class="hover:text-primary transition-colors" href="#">Sustainability</a></li>
<li><a class="hover:text-primary transition-colors" href="#">Investor Relations</a></li>
</ul>
</div>
<div>
<h4 class="font-bold text-[#0d161c] dark:text-slate-200 mb-4">Newsletter</h4>
<p class="text-sm mb-4">Subscribe to get special offers and updates!</p>
<div class="flex gap-2">
<input type="email" placeholder="Your email" class="flex-grow px-3 py-2 rounded-md border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-800 text-sm text-[#0d161c] dark:text-white">
<button type="button" class="px-4 py-2 bg-primary hover:bg-blue-600 text-white rounded-md text-sm font-medium transition-colors">→</button>
</div>
</div>
</div>
<div class="text-center mt-8 pt-6 border-t border-slate-200 dark:border-slate-700">
<p class="text-sm text-slate-600 dark:text-slate-400">&copy; {% now "Y" %} eKart. All Rights Reserved.</p>
</div>
</footer>

<!-- Go to Top Button -->
<button id="go-to-top-btn" 
        class="fixed bottom-6 right-6 w-12 h-12 bg-primary hover:bg-blue-600 text-white rounded-full shadow-lg opacity-0 pointer-events-none transition-all duration-300 flex items-center justify-center z-40"
        aria-label="Go to top">
    <span class="material-symbols-outlined">arrow_upward</span>
</button>

</div>
</div>

<!-- JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    // --- Selectors ---
    const menuToggle = document.getElementById('menu-toggle');
    const navLinks = document.getElementById('navbar-links');
    const paymentForm = document.getElementById('paymentForm');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const goToTopBtn = document.getElementById('go-to-top-btn');

    // --- Mobile Menu Toggle ---
    if (menuToggle && navLinks) {
        menuToggle.addEventListener('click', () => {
            navLinks.classList.toggle('nav-active');
        });
    }
    
    // --- Payment Method Toggle ---
    const paymentRadios = document.querySelectorAll('input[name="payment_method"]');
    const paymentFields = document.querySelectorAll('.payment-fields');

    paymentRadios.forEach(radio => {
        radio.addEventListener('change', function () {
            paymentFields.forEach(field => {
                field.style.display = 'none';
            });
            const selectedMethod = this.value;
            if (selectedMethod) {
                const targetFields = document.getElementById(selectedMethod + '_fields');
                if (targetFields) {
                    targetFields.style.display = 'block';
                }
            }
        });
    });

    const checkedRadio = document.querySelector('input[name="payment_method"]:checked');
    if (checkedRadio) {
        checkedRadio.dispatchEvent(new Event('change'));
    }

    // --- Validation Helper Functions ---
    
    function showError(input, message) {
        // Add error classes to the input
        input.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500/20');
        
        // Create and insert error message
        const errorEl = document.createElement('p');
        errorEl.className = 'form-error text-red-500 text-xs mt-1';
        errorEl.textContent = message;
        
        // Insert after the input
        input.insertAdjacentElement('afterend', errorEl);
    }

    function clearErrors() {
        // Remove all error messages
        document.querySelectorAll('.form-error').forEach(el => el.remove());
        
        // Remove error classes from all inputs in the form
        paymentForm.querySelectorAll('input, select').forEach(input => {
            input.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500/20');
        });
    }

    function validateCreditCard() {
        let isValid = true;
        const cardNo = paymentForm.querySelector('[name="card_no"]');
        const holderName = paymentForm.querySelector('[name="holder_name"]');
        const expiryDate = paymentForm.querySelector('[name="expiry_date"]');

        // Card Number (simple check: 16 digits after removing spaces)
        if (cardNo.value.replace(/\s/g, '').length < 16) {
            showError(cardNo, 'Please enter a valid 16-digit card number.');
            isValid = false;
        }

        // Cardholder Name
        if (holderName.value.trim() === '') {
            showError(holderName, 'Cardholder name is required.');
            isValid = false;
        }

        // Expiry Date Validation
        const expiryRegex = /^(0[1-9]|1[0-2])\/?([0-9]{2})$/;
        if (!expiryRegex.test(expiryDate.value)) {
            showError(expiryDate, 'Please enter a valid date in MM/YY format (e.g., 05/28).');
            isValid = false;
        } else {
            const [month, year] = expiryDate.value.split('/').map(Number);
            const fullYear = 2000 + year;
            
            const now = new Date();
            const currentYear = now.getFullYear();
            const currentMonth = now.getMonth() + 1; // getMonth() is 0-indexed
            const maxYear = currentYear + 6;

            // Check if expired
            if (fullYear < currentYear || (fullYear === currentYear && month < currentMonth)) {
                showError(expiryDate, 'This card has expired.');
                isValid = false;
            }
            // Check if too far in the future
            else if (fullYear > maxYear) {
                showError(expiryDate, `Expiry year must be ${maxYear} or earlier.`);
                isValid = false;
            }
        }
        
        return isValid;
    }

    function validateUPI() {
        let isValid = true;
        const walletId = paymentForm.querySelector('[name="wallet_id"]');
        const email = paymentForm.querySelector('[name="email"]');
        const provider = paymentForm.querySelector('[name="wallet_provider"]');
        
        // UPI ID (simple check)
        const upiRegex = /(^(\d{10})$)|(.+@.+)/; // 10 digits OR user@bank
        if (!upiRegex.test(walletId.value)) {
            showError(walletId, 'Please enter a valid 10-digit mobile or UPI ID (e.g., name@upi).');
            isValid = false;
        }
        
        // Email
        const emailRegex = /^\S+@\S+\.\S+$/;
        if (!emailRegex.test(email.value)) {
            showError(email, 'Please enter a valid email address.');
            isValid = false;
        }

        // Provider
        if (provider.value === '') {
            showError(provider, 'Please select a wallet provider.');
            isValid = false;
        }
        
        return isValid;
    }

    function validateBank() {
        let isValid = true;
        const accNo = paymentForm.querySelector('[name="bank_acc_no"]');
        const bankName = paymentForm.querySelector('[name="bank_name"]');

        if (accNo.value.trim() === '') {
            showError(accNo, 'Bank account number is required.');
            isValid = false;
        }

        if (bankName.value.trim() === '') {
            showError(bankName, 'Bank name is required.');
            isValid = false;
        }
        
        return isValid;
    }

    function validateForm() {
        clearErrors();
        const selectedMethod = document.querySelector('input[name="payment_method"]:checked').value;
        
        if (selectedMethod === 'credit') {
            return validateCreditCard();
        } else if (selectedMethod === 'upi') {
            return validateUPI();
        } else if (selectedMethod === 'bank') {
            return validateBank();
        }
        return false; // Should not happen
    }

    // --- Form Submission with Validation & Loading Screen ---
    paymentForm.addEventListener('submit', function(e) {
        e.preventDefault(); // Stop form submission immediately

        // Run validation
        if (validateForm()) {
            // Validation Passed: Show loading overlay and proceed
            loadingOverlay.classList.add('active');
            
            // Simulate step progression (visual feedback)
            setTimeout(() => {
                document.getElementById('step1').classList.add('completed');
                document.getElementById('step1-icon').style.display = 'none'; // Hide "1"
                document.getElementById('step2').classList.add('active');
            }, 800);
            
            setTimeout(() => {
                document.getElementById('step2').classList.add('completed');
                document.getElementById('step2-icon').style.display = 'none'; // Hide "2"
                document.getElementById('step3').classList.add('active');
            }, 1600);
            
            // After animation, submit the form for real
            setTimeout(() => {
                paymentForm.submit(); // This submits to your Django backend
            }, 2400);

        } else {
            // Validation Failed: Do nothing, errors are already shown.
            console.log("Validation failed. Please correct the errors.");
        }
    });

    // --- Go to Top Button ---
    if (goToTopBtn) {
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                goToTopBtn.classList.remove('opacity-0', 'pointer-events-none');
            } else {
                goToTopBtn.classList.add('opacity-0', 'pointer-events-none');
            }
        });
        
        goToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }

    // --- Input Formatters ---

    // Card number formatting (add spaces)
    const cardInput = document.querySelector('input[name="card_no"]');
    if (cardInput) {
        cardInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, ''); // Remove existing spaces
            let formattedValue = value.replace(/(.{4})/g, '$1 ').trim(); // Add space every 4 chars
            e.target.value = formattedValue;
        });
    }

    // Expiry date formatting (MM/YY)
    const expiryInput = document.querySelector('input[name="expiry_date"]');
    if (expiryInput) {
        expiryInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
            if (value.length > 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4); // Add slash
            }
            e.target.value = value;
        });
    }
});
</script>
</body>
</html>
